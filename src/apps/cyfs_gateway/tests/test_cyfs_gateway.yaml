limiters:
  test:
    upper_limiter: global
    download_limit: 1MB/s
    upload_limit: 1MB/s
    concurrent: 256

  global:
    download_limit: 1GB/s
    upload_limit: 1GB/s
    concurrent: 2048

stacks:
  test1:
    bind: 0.0.0.0:18080
    protocol: tcp
    hook_point:
      main:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              http-probe && call-server ${REQ.dest_host};
              reject;

  test2:
    bind: 0.0.0.0:18081
    protocol: tcp
    hook_point:
      main:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              exec --lib global_test1;
              http-probe && call-server ${REQ.dest_host};
              reject;

  test3:
    bind: 0.0.0.0:9545
    protocol: udp
    transparent: false
    hook_point:
      main:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              call-server main_dns;

servers:
  web3.buckyos.com:
    type: http
    hook_point:
      main:
        priority: 0
        blocks:
          default:
            priority: 1
            block: |
              starts-with ${REQ.path} "/api" && rewrite ${REQ.path} "/api*" "*" && map-add REQ host www.buckyos.com && forward http://127.0.0.1:18081;
      main1:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              starts-with ${REQ.path} "/sn" && rewrite ${REQ.path} "/sn*" "/*" && call-server sn.http;

          default1:
            priority: 2
            block: |
              call-server web3_dir;

  www.buckyos.com:
    type: http
    hook_point:
      main:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              call-server www_dir;

  web3_dir:
    type: dir
    root_path: {{web3_dir}}

  www_dir:
    type: dir
    root_path: {{www_dir}}

  main_dns:
    type: dns
    hook_point:
      main:
        priority: 1
        blocks:
          default:
            priority: 1
            block: |
              resolve ${REQ.name} ${REQ.record_type} local_dns && return;
              resolve ${REQ.name} ${REQ.record_type} "223.5.5.5:53" && return;

  sn:
    type: sn
    host: web3.buckyos.io
    ip: 127.0.0.1
    zone_config_jwt: test
    zone_config_pkx: test

  local_dns:
    type: local_dns
    file_path: {{local_dns}}

global_process_chains:
  global_test1:
    priority: 1
    blocks:
      default:
        priority: 1
        block: |
          echo "hello global_test1";
